<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameStateManager í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>GameStateManager í…ŒìŠ¤íŠ¸</h1>
    <div id="test-results"></div>
    
    <script src="gameStateManager.js"></script>
    <script>
        // í…ŒìŠ¤íŠ¸ìš© ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        window.nations = [
            { id: 1, name: 'í…ŒìŠ¤íŠ¸ êµ­ê°€', color: '#ff0000', population: 1000000 }
        ];
        window.nextNationId = 2;
        window.selectedNation = null;
        window.currentYear = 100;
        window.simulationRunning = false;
        
        // í…ŒìŠ¤íŠ¸ìš© pixelMap ê°ì²´
        window.pixelMap = {
            terrainMap: [['grassland', 'forest'], ['sand', 'water']],
            nationMap: [[1, null], [null, null]],
            cityMap: [{ x: 0, y: 0, name: 'í…ŒìŠ¤íŠ¸ ë„ì‹œ', nationId: 1 }],
            provinceMap: [[1, null], [null, null]],
            provinceNames: [{ id: 1, name: 'í…ŒìŠ¤íŠ¸ ì§€ë°©' }],
            zoomLevel: 1,
            panX: 0,
            panY: 0,
            mapWidth: 300,
            mapHeight: 200,
            render: function() { console.log('ë§µ ë Œë”ë§'); }
        };
        
        const results = document.getElementById('test-results');
        
        function runTests() {
            const manager = window.gameStateManager;
            let testsPassed = 0;
            let totalTests = 0;
            
            function test(name, testFn) {
                totalTests++;
                try {
                    const result = testFn();
                    if (result) {
                        testsPassed++;
                        results.innerHTML += `<p style="color: green;">âœ… ${name}: í†µê³¼</p>`;
                    } else {
                        results.innerHTML += `<p style="color: red;">âŒ ${name}: ì‹¤íŒ¨</p>`;
                    }
                } catch (error) {
                    results.innerHTML += `<p style="color: red;">âŒ ${name}: ì˜¤ë¥˜ - ${error.message}</p>`;
                }
            }
            
            // í…ŒìŠ¤íŠ¸ 1: GameStateManager ì¸ìŠ¤í„´ìŠ¤ ìƒì„± í™•ì¸
            test('GameStateManager ì¸ìŠ¤í„´ìŠ¤ ìƒì„±', () => {
                return manager instanceof GameStateManager;
            });
            
            // í…ŒìŠ¤íŠ¸ 2: í˜„ì¬ ê²Œì„ ìƒíƒœ ìˆ˜ì§‘
            test('í˜„ì¬ ê²Œì„ ìƒíƒœ ìˆ˜ì§‘', () => {
                const state = manager.collectCurrentGameState();
                return state && state.version && state.gameData && state.gameData.nations.length === 1;
            });
            
            // í…ŒìŠ¤íŠ¸ 3: ë°ì´í„° ê²€ì¦
            test('ë°ì´í„° ê²€ì¦', () => {
                const state = manager.collectCurrentGameState();
                return manager.validateGameData(state);
            });
            
            // í…ŒìŠ¤íŠ¸ 4: ì˜ëª»ëœ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨
            test('ì˜ëª»ëœ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨', () => {
                return !manager.validateGameData({ invalid: 'data' });
            });
            
            // í…ŒìŠ¤íŠ¸ 5: ì €ì¥ ê¸°ëŠ¥
            test('ê²Œì„ ìƒíƒœ ì €ì¥', () => {
                return manager.saveGameState(false);
            });
            
            // í…ŒìŠ¤íŠ¸ 6: ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥
            test('ê²Œì„ ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸°', () => {
                // ë¨¼ì € ë°ì´í„° ë³€ê²½
                window.currentYear = 200;
                // ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤í–‰
                const result = manager.loadGameState();
                // ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆëŠ”ì§€ í™•ì¸
                return result && window.currentYear === 100;
            });
            
            // í…ŒìŠ¤íŠ¸ 7: ë°±ì—… ìƒì„±
            test('ë°±ì—… ìƒì„±', () => {
                manager.createBackup('test');
                const backups = manager.getBackups();
                return backups.backups.length > 0;
            });
            
            // í…ŒìŠ¤íŠ¸ 8: ì €ì¥ ê³µê°„ ì‚¬ìš©ëŸ‰ í™•ì¸
            test('ì €ì¥ ê³µê°„ ì‚¬ìš©ëŸ‰ í™•ì¸', () => {
                const usage = manager.getStorageUsage();
                return usage && typeof usage.used === 'number' && typeof usage.percentage === 'number';
            });
            
            // í…ŒìŠ¤íŠ¸ 9: ë°”ì´íŠ¸ í¬ë§·íŒ…
            test('ë°”ì´íŠ¸ í¬ë§·íŒ…', () => {
                const formatted = manager.formatBytes(1024);
                return formatted === '1 KB';
            });
            
            // í…ŒìŠ¤íŠ¸ 10: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
            test('ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜', () => {
                const oldData = { version: '0.9.0', timestamp: Date.now(), gameData: {} };
                const migrated = manager.migrateData(oldData);
                return migrated.version === '1.0.0';
            });
            
            // ê²°ê³¼ ìš”ì•½
            results.innerHTML += `<hr><h2>í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${testsPassed}/${totalTests} í†µê³¼</h2>`;
            
            if (testsPassed === totalTests) {
                results.innerHTML += '<p style="color: green; font-weight: bold;">ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!</p>';
            } else {
                results.innerHTML += '<p style="color: red; font-weight: bold;">âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</p>';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>